!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Dynamowaves={})}(this,(function(t){"use strict";class e extends HTMLElement{constructor(){super(),this.isAnimating=!1,this.animationFrameId=null,this.elapsedTime=0,this.startTime=null,this.isGeneratingWave=!1,this.currentPath=null,this.targetPath=null,this.pendingTargetPath=null,this.intersectionObserver=null,this.observerOptions=null,this.random=Math.random,this.startEndZero=!1}connectedCallback(){const t=this.className,e=this.id??Math.random().toString(36).substring(7),n=this.getAttribute("style"),r=this.getAttribute("data-wave-face")||"top",a=parseInt(this.getAttribute("data-wave-points"),10);this.points=Number.isFinite(a)?Math.max(2,a):6;const h=this.getAttribute("data-wave-variance"),o=this.getAttribute("data-variance"),d=parseFloat(h??o??"");this.variance=Number.isFinite(d)?d:3,this.duration=parseFloat(this.getAttribute("data-wave-speed"))||7500;const c=this.getAttribute("data-wave-seed"),l=s(c),u="string"==typeof c&&""!==c.trim();this.random=u&&!l?function(t){let e=0;const i=String(t);for(let t=0;t<i.length;t++)e=(e<<5)-e+i.charCodeAt(t),e|=0;let n=e>>>0;return function(){n+=1831565813;let t=n;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}}(c):Math.random;const p=this.getAttribute("data-start-end-zero");this.startEndZero="string"==typeof p&&["","true","1","yes","on"].includes(p.trim().toLowerCase()),this.vertical="left"===r||"right"===r;const m="right"===r,g="bottom"===r;this.width=this.vertical?160:1440,this.height=this.vertical?1440:160,this.currentPath=l||i({width:this.width,height:this.height,points:this.points,variance:this.variance,vertical:this.vertical,random:this.random,startEndZero:this.startEndZero}),this.updateSeedAttribute(this.currentPath),this.targetPath=i({width:this.width,height:this.height,points:this.points,variance:this.variance,vertical:this.vertical,random:this.random,startEndZero:this.startEndZero}),this.innerHTML=`\n      <svg \n        viewBox="${this.vertical?"0 0 160 1440":"0 0 1440 160"}"\n        preserveAspectRatio="none"\n        class="${t||""}"\n        style="${m?"transform:scaleX(-1);":""}${g?"transform:scaleY(-1);":""}${n||""}"\n        id="${e}"\n        aria-hidden="true"\n        role="presentation"\n      >\n        <path d="${this.currentPath}" style="stroke:inherit; fill: inherit"></path>\n      </svg>\n    `,this.svg=this.querySelector("svg"),this.path=this.querySelector("path"),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.generateNewWave=this.generateNewWave.bind(this);const v=this.getAttribute("data-wave-observe");v&&this.setupIntersectionObserver(v),"true"===this.getAttribute("data-wave-animate")&&("undefined"==typeof window||"function"!=typeof window.matchMedia||window.matchMedia("(prefers-reduced-motion: reduce)").matches||this.play())}play(t=null){if(this.isAnimating)return;this.isAnimating=!0;const e=t||this.duration,n=()=>{this.pendingTargetPath||(this.pendingTargetPath=i({width:this.width,height:this.height,points:this.points,variance:this.variance,vertical:this.vertical,random:this.random,startEndZero:this.startEndZero})),this.animateWave(e,(()=>{this.currentPath=this.targetPath,this.updateSeedAttribute(this.currentPath),this.targetPath=this.pendingTargetPath,this.pendingTargetPath=i({width:this.width,height:this.height,points:this.points,variance:this.variance,vertical:this.vertical,random:this.random,startEndZero:this.startEndZero}),this.isAnimating&&n()}))};n()}pause(){this.isAnimating&&(this.isAnimating=!1,cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null,this.elapsedTime+=performance.now()-(this.startTime||performance.now()),this.startTime=null)}disconnectedCallback(){this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null)}setupIntersectionObserver(t){const[e,i="0px"]=t.split(":"),n="once"===e;this.observerOptions={root:null,rootMargin:i,threshold:0},"undefined"!=typeof window&&void 0!==window.IntersectionObserver?(this.intersectionObserver=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting||(this.generateNewWave(),n&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null))}))}),this.observerOptions),this.intersectionObserver.observe(this)):console.warn("IntersectionObserver is not available in this environment. Wave regeneration on intersection will be disabled.")}generateNewWave(t=800){this.isGeneratingWave||this.animationFrameId||(t<1&&(t=1),this.isGeneratingWave=!0,this.pendingTargetPath=i({width:this.width,height:this.height,points:this.points,variance:this.variance,vertical:this.vertical,random:this.random,startEndZero:this.startEndZero}),this.animateWave(t,(()=>{this.currentPath=this.targetPath,this.targetPath=this.pendingTargetPath,this.pendingTargetPath=null,this.updateSeedAttribute(this.currentPath),this.isGeneratingWave=!1,this.animationFrameId=null})))}updateSeedAttribute(t){const e=n(t);if(e){this.getAttribute("data-wave-seed")!==e&&this.setAttribute("data-wave-seed",e)}}animateWave(t,e=null){const n=r(this.currentPath),s=r(this.targetPath);if(n.length!==s.length)return console.error("Point mismatch! Regenerating waves to ensure consistency."),this.currentPath=i({width:this.width,height:this.height,points:this.points,variance:this.variance,vertical:this.vertical,random:this.random,startEndZero:this.startEndZero}),void(this.targetPath=i({width:this.width,height:this.height,points:this.points,variance:this.variance,vertical:this.vertical,random:this.random,startEndZero:this.startEndZero}));const h=i=>{this.startTime||(this.startTime=i-this.elapsedTime);const r=i-this.startTime,o=Math.min(r/t,1),d=a(n,s,o,this.vertical,this.height,this.width);this.path.setAttribute("d",d),o<1?this.animationFrameId=requestAnimationFrame(h):(this.elapsedTime=0,this.startTime=null,e&&e(),"function"==typeof CustomEvent&&this.dispatchEvent(new CustomEvent("dynamo-wave-complete",{detail:{duration:t,direction:this.vertical?"vertical":"horizontal"}})))};this.animationFrameId=requestAnimationFrame(h)}}function i({width:t,height:e,points:i,variance:n,vertical:s=!1,random:r=Math.random,startEndZero:a=!1}){const h=Math.max(2,Number.isFinite(i)?Math.floor(i):2),o=[],d=s?e/(h-1):t/(h-1);for(let i=0;i<h;i++){const a=s?e-d*i:d*i,h=s?t-.1*t-r()*(n*t*.25):e-.1*e-r()*(n*e*.25);o.push(s?{x:h,y:a}:{x:a,y:h})}a&&o.length&&(s?(o[0].x=t,o[o.length-1].x=t):(o[0].y=e,o[o.length-1].y=e));let c=s?`M ${t} ${e} L ${o[0].x} ${e}`:`M 0 ${e} L 0 ${o[0].y}`;for(let t=0;t<o.length-1;t++){const e=o[t],i=o[t+1],n=(e.x+i.x)/2,s=(e.y+i.y)/2;c+=` Q ${e.x} ${e.y}, ${n} ${s}`}const l=o[o.length-1];return c+=s?` Q ${l.x} ${l.y}, 0 0 L ${t} 0 L ${t} ${e} Z`:` Q ${l.x} ${l.y}, ${t} ${l.y} L ${t} ${e} Z`,c}function n(t){if("string"!=typeof t)return"";const e=t.trim().replace(/\s+/g," ");try{if("function"==typeof btoa){const t=function(t){if("undefined"!=typeof TextEncoder){const e=(new TextEncoder).encode(t);let i="";return e.forEach((t=>{i+=String.fromCharCode(t)})),i}return Array.from(t).map((t=>String.fromCharCode(t.charCodeAt(0)))).join("")}(e);return btoa(t).replace(/=+$/,"")}if("undefined"!=typeof Buffer)return Buffer.from(e,"utf8").toString("base64").replace(/=+$/,"")}catch(t){console.warn("Failed to encode wave seed",t)}return""}function s(t){if("string"!=typeof t||""===t.trim())return null;const e=t.padEnd(4*Math.ceil(t.length/4),"=");try{if("function"==typeof atob){return function(t){if("undefined"!=typeof TextDecoder){const e=Uint8Array.from(t,(t=>t.charCodeAt(0)));return(new TextDecoder).decode(e)}return t}(atob(e))}if("undefined"!=typeof Buffer)return Buffer.from(e,"base64").toString("utf8")}catch(t){console.warn("Failed to decode wave seed",t)}return null}function r(t){const e=[],i="[+-]?\\d*(?:\\.\\d+)?(?:[eE][+-]?\\d+)?",n=new RegExp(`Q\\s(${i})\\s(${i}),\\s(${i})\\s(${i})`,"g");let s;for(;null!==(s=n.exec(t));)e.push({cpX:parseFloat(s[1]),cpY:parseFloat(s[2]),x:parseFloat(s[3]),y:parseFloat(s[4])});return e}function a(t,e,i,n=!1,s,r){const a=t.map(((t,s)=>{const r=e[s];return{cpX:t.cpX+(r.cpX-t.cpX)*i,cpY:n?t.cpY:t.cpY+(r.cpY-t.cpY)*i,x:n?t.x+(r.x-t.x)*i:t.x,y:n?t.y:t.y+(r.y-t.y)*i}}));let h=n?`M ${r} ${s} L ${a[0].x} ${s}`:`M 0 ${s} L 0 ${a[0].y}`;for(let t=0;t<a.length;t++){const{cpX:e,cpY:i,x:n,y:s}=a[t];h+=` Q ${e} ${i}, ${n} ${s}`}return h+=n?` L 0 0 L ${r} 0 L ${r} ${s} Z`:` L ${r} ${s} Z`,h}"undefined"!=typeof window&&window.customElements&&!window.customElements.get("dynamo-wave")&&window.customElements.define("dynamo-wave",e),t.DynamoWave=e,t.decodeWaveSeed=s,t.encodeWaveSeed=n,t.generateWave=i,t.interpolateWave=a,t.parsePath=r}));
